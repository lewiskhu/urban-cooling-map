<!DOCTYPE html>
<html>
<head>
    <title>Urban Cooling Map</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }
        .legend {
            background: white; padding: 10px; line-height: 1.5; color: #333;
            box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px;
        }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <script>
        // --- CONFIGURATION ---
        const DATA_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vQd-WnbC41NJSv7XPQ-zbrHKOjVYCIXCnc39UdtCrtdDlpi54-nB8R5Y2m2_7Z2RujXYv1mHtJANfHP/pub?output=csv"; // Live Google Sheet CSV link

        // Initialize Map
        var map = L.map('map').setView([40.785091, -73.968285], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>'
        }).addTo(map);

        // Load Data
        if (DATA_URL) {
            Papa.parse(DATA_URL, {
                download: true,
                header: true,
                complete: function(results) {
                    results.data.forEach(row => {
                        if(row.Lat && row.Lon) {
                            var score = parseFloat(row.Cooling_Score);
                            var color = score > 8 ? '#006400' : (score > 5 ? '#32CD32' : '#FFD700');
                            
                            L.circleMarker([row.Lat, row.Lon], {
                                radius: 8, fillColor: color, color: "#000", weight: 1, opacity: 1, fillOpacity: 0.8
                            })
                            .bindPopup(`<b>${row.Name}</b><br>Cooling Score: ${score}<br>${row.Description}`)
                            .addTo(map);
                        }
                    });
                }
            });
        } else {
            alert("Map is ready! Please edit index.html and add your Google Sheet CSV Link.");
        }
    </script>
</body>
</html>
